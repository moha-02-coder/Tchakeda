<div class="page-container">
  <div class="page-header">
    <button class="btn btn-light back-btn" (click)="cancel()">
      <i class="fas fa-arrow-left"></i> Retour
    </button>
    <h4 class="page-title">Créer un appartement</h4>
  </div>

  <div class="content-container">
    <form (ngSubmit)="create()" class="form-card">
      <div class="form-grid">
        <!-- Nom -->
        <div class="form-group">
          <input type="text" id="name" [(ngModel)]="form.name" name="name" class="underline-input" required placeholder="Saisis le nom" />
          <label for="name" class="label">Nom</label>
          <div class="error" *ngIf="errors.name">{{ errors.name }}</div>
        </div>

        <!-- Type -->
        <div class="form-group">
          <select id="type" [(ngModel)]="form.type" name="type" class="underline-input" required>
            <option [ngValue]="null">Sélectionner...</option>
            <option value="Studio">Studio</option>
            <option value="T2">Appartement</option>
            <option value="T3">Residence</option>
            <option value="T4">Villa</option>
            <option value="Duplex">Hôtel</option>
          </select>
          <label for="type" class="label">Type</label>
          <div class="error" *ngIf="errors.type">{{ errors.type }}</div>
        </div>

        <!-- Nombre de pièces -->
        <div class="form-group">
          <input type="number" id="rooms" [(ngModel)]="form.rooms" name="rooms" class="underline-input" required min="1" placeholder="Nombre de pièces" />
          <label for="rooms" class="label">Nombre de pièces</label>
          <div class="error" *ngIf="errors.rooms">{{ errors.rooms }}</div>
        </div>

        <!-- Location (montant) -->
        <div class="form-group">
          <input type="number" id="rent" [(ngModel)]="form.rent" name="rent" class="underline-input" required min="1" placeholder="Loyer mensuel" />
          <label for="rent" class="label">Loyer mensuel</label>
          <span class="currency">Fcfa</span>
          <div class="error" *ngIf="errors.rent">{{ errors.rent }}</div>
        </div>

        <!-- Statut -->
        <div class="form-group">
          <input type="text" id="status" [(ngModel)]="form.status" name="status" class="underline-input" [readonly]="true" placeholder="Statut" />
          <label for="status" class="label">Statut</label>
        </div>

        <!-- Bâtiment -->
        <div class="form-group full-width">
          <div class="building-selector">
            <select id="buildingId" [(ngModel)]="form.buildingId" name="buildingId" class="underline-input" required>
              <option [ngValue]="0">Sélectionner...</option>
              <option *ngFor="let building of buildings" [ngValue]="building.id">{{ building.name }}</option>
            </select>
            <label for="buildingId" class="label">Bâtiment</label>
            <button type="button" class="btn btn-light new-building-btn" (click)="goToNewBuilding()">
              <i class="fas fa-plus"></i> Nouveau bâtiment
            </button>
          </div>
          <div class="error" *ngIf="errors.buildingId">{{ errors.buildingId }}</div>
        </div>

        <!-- Images des pièces -->
        <div class="form-group card full-width">
          <label class="label">Images des pièces</label>
          <p class="input-description">Max 6 images (formats: jpg, jpeg, png, webp, taille max: 2Mo)</p>
          <div class="apartment-images-grid">
            <div *ngFor="let img of images; let i = index" class="image-grid-item">
              <img [src]="getDisplayImage(img, roomLabels[i] || '')" [alt]="roomLabels[i] || 'Pièce ' + (i+1)" class="apartment-img" />
              <button type="button" class="remove-image" (click)="removeImage(i)">
                <i class="fas fa-times"></i>
              </button>
              <div class="form-group">
                <label for="roomLabel-{{i}}" class="label">Nom de la pièce</label>
                <input type="text" id="roomLabel-{{i}}" class="underline-input" [(ngModel)]="roomLabels[i]" name="roomLabels[{{i}}]" placeholder="Nom de la pièce (ex: Salon, Chambre...)" />
              </div>
              <div class="form-group">
                <label for="roomDesc-{{i}}" class="label">Description</label>
                <textarea id="roomDesc-{{i}}" class="underline-input" [(ngModel)]="roomDescriptions[i]" name="roomDescriptions[{{i}}]" placeholder="Description de la pièce"></textarea>
              </div>
            </div>
            <!-- Bouton d’ajout -->
            <div class="image-grid-item add-image">
              <label class="file-upload-label label" [class.disabled]="images.length >= 6">
                <i class="fas fa-plus"></i> Ajouter une photo pour la pièce
                <input type="file" name="roomImages" accept="image/jpeg,image/png,image/webp" (change)="onImagesSelected($event)" [disabled]="images.length >= 6" />
              </label>
            </div>
          </div>
          <div class="error" *ngIf="errors.roomImages">{{ errors.roomImages }}</div>
        </div>
      </div>

      <!-- Actions -->
      <div class="form-actions full-width">
        <button type="button" class="btn btn-light" (click)="cancel()">Annuler</button>
        <button type="submit" class="btn btn-primary">Créer l'appartement</button>
      </div>
    </form>
  </div>
</div>