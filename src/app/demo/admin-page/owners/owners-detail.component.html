<div class="page-container">
  <div class="page-header">
    <button class="btn btn-light back-btn" (click)="back()">
      <i class="fas fa-arrow-left"></i> Propriétaires
    </button>
    <h4 class="page-title">Détails du propriétaire</h4>
  </div>

  <!-- Modal de suppression -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay">
    <div class="modal-card">
      <h5>Confirmer la suppression</h5>
      <p>Voulez-vous vraiment supprimer ce propriétaire ? Cette action est irréversible.</p>
      <div class="form-actions center">
        <button type="button" class="btn btn-light" (click)="showDeleteConfirm = false">Annuler</button>
        <button type="button" class="btn btn-danger" (click)="deleteOwner()">Supprimer</button>
      </div>
    </div>
  </div>

  <!-- Section 1: Informations personnelles -->
  <div class="form-card">
    <div class="card-header">
      <h5>Informations du propriétaire</h5>
      <div class="action-buttons">
        <ng-container *ngIf="!editMode">
          <button class="action-btn edit" (click)="enableEdit()" title="Modifier les informations">
            <i class="fas fa-edit"></i>
          </button>
          <button class="action-btn delete" title="Supprimer le propriétaire" (click)="confirmDeleteOwner()">
            <i class="fas fa-trash"></i>
          </button>
        </ng-container>
        <ng-container *ngIf="editMode">
          <button class="action-btn save" type="submit" title="Valider les modifications" (click)="save()">
            <i class="fas fa-check"></i>
          </button>
        </ng-container>
      </div>
    </div>

    <!-- Mode édition -->
    <form *ngIf="editMode" (ngSubmit)="save()" class="form-grid">
      <div class="form-group">
        <input type="text" id="name" [(ngModel)]="form.name" name="name" class="underline-input" required placeholder="Nom complet" />
        <label for="name" class="label">Nom complet</label>
        <div class="error" *ngIf="errors.name">{{ errors.name }}</div>
      </div>

      <div class="form-group">
        <input type="text" id="country" [(ngModel)]="form.country" name="country" class="underline-input" required placeholder="Pays" />
        <label for="country" class="label">Pays</label>
        <div class="error" *ngIf="errors.country">{{ errors.country }}</div>
      </div>

      <div class="form-group">
        <input type="text" id="phone" [(ngModel)]="form.phone" name="phone" class="underline-input" required placeholder="Téléphone" />
        <label for="phone" class="label">Téléphone</label>
        <div class="error" *ngIf="errors.phone">{{ errors.phone }}</div>
      </div>

      <div class="form-group">
        <input type="text" id="adress" [(ngModel)]="form.adress" name="adress" class="underline-input" required placeholder="Adresse" />
        <label for="adress" class="label">Adresse</label>
        <div class="error" *ngIf="errors.adress">{{ errors.adress }}</div>
      </div>

      <div class="form-group">
        <input type="email" id="email" [(ngModel)]="form.email" name="email" class="underline-input" required placeholder="Email" />
        <label for="email" class="label">Email</label>
        <div class="error" *ngIf="errors.email">{{ errors.email }}</div>
      </div>

      <div class="form-group">
        <input type="text" id="profession" [(ngModel)]="form.profession" name="profession" class="underline-input" placeholder="Profession" />
        <label for="profession" class="label">Profession</label>
      </div>
    </form>

    <!-- Mode visualisation -->
    <div *ngIf="!editMode" class="details-grid">
      <div class="form-group">
        <label>Nom complet</label>
        <p>{{ owner?.name || '-' }}</p>
      </div>

      <div class="form-group">
        <label>Pays</label>
        <p>{{ owner?.country || '-' }}</p>
      </div>

      <div class="form-group">
        <label>Téléphone</label>
        <p>{{ owner?.phone || '-' }}</p>
      </div>

      <div class="form-group">
        <label>Adresse</label>
        <p>{{ owner?.adress || '-' }}</p>
      </div>

      <div class="form-group">
        <label>Email</label>
        <p>{{ owner?.email || '-' }}</p>
      </div>

      <div class="form-group">
        <label>Profession</label>
        <p>{{ owner?.profession || '-' }}</p>
      </div>
    </div>
  </div>

  <!-- Section 2: Données du propriétaire (bâtiments, appartements, factures) -->
  <div class="form-card">
    <div class="card-header">
      <h5>Données du propriétaire</h5>
    </div>

    <div class="owner-data-flex">
      <!-- Colonne gauche : bâtiments -->
      <div class="owner-buildings-list">
        <h6 class="section-subtitle">Mes bâtiments</h6>
        <div *ngFor="let building of buildings" 
             (click)="selectBuilding(building)" 
             [ngClass]="{'selected-building': selectedBuilding?.id === building.id}" 
             class="building-card">
          <div class="building-name">{{ building.name }}</div>
          <div class="building-address">{{ building.address }}</div>
          <div class="building-city">{{ building.city }}</div>
        </div>
        <div *ngIf="buildings.length === 0" class="no-data">
          Aucun bâtiment enregistré
        </div>
      </div>

      <!-- Colonne droite : tableau -->
      <div class="owner-data-content">
        <div class="owner-table-tabs">
          <button class="tab-btn" [class.active-tab]="activeTab === 'appartements'" (click)="activeTab = 'appartements'">
            Appartements
          </button>
          <button class="tab-btn" [class.active-tab]="activeTab === 'factures'" (click)="activeTab = 'factures'">
            Factures
          </button>
        </div>

        <div class="tab-content" *ngIf="activeTab === 'appartements'">
          <div class="table-container">
<table class="data-table">
  <thead>
    <tr>
      <th>Appartement</th>
      <th>Locataire</th>
      <th>Mensualité</th>
      <th>Date de paiement</th>
      <th>Recouvreur</th>
      <th>Statut</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let apt of selectedBuildingApartments">
      <!-- Nom de l'appart -->
      <td>{{ apt.name || '-' }}</td>

      <!-- Locataire -->
  <td>{{ getTenantName(apt) }}</td>

      <!-- Mensualité -->
  <td>{{ getMonthlyRent(apt) ? (getMonthlyRent(apt) | currency:'XOF':'symbol':'1.0') : '-' }}</td>

      <!-- Date de paiement -->
  <td>-</td>

      <!-- Recouvreur -->
  <td>{{ getCollector(apt) }}</td>

      <!-- Statut -->
      <td>
        <span class="status-badge">{{ getStatus(apt) }}</span>
      </td>
    </tr>

    <!-- Message si aucun appartement -->
    <tr *ngIf="selectedBuildingApartments.length === 0">
      <td colspan="6" class="no-data">
        Aucun appartement pour ce bâtiment
      </td>
    </tr>
  </tbody>
</table>

          </div>
        </div>

        <div class="tab-content" *ngIf="activeTab === 'factures'">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>N° Facture</th>
                  <th>Appartement</th>
                  <th>Locataire</th>
                  <th>Période</th>
                  <th>Loyer</th>
                  <th>Statut</th>
                  <th>Date paiement</th>
                  <th>Observations</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let facture of selectedBuildingFactures">
                  <td>{{ facture.invoiceNumber || '-' }}</td>
                  <td>{{ facture.apartmentName || '-' }}</td>
                  <td>{{ facture.tenantName || '-' }}</td>
                  <td>{{ facture.period || '-' }}</td>
                  <td>{{ facture.price ? (facture.price | number:'1.0-0') + ' FCFA' : '-' }}</td>
                  <td>
                    <span class="status-badge" [ngClass]="{
                      'status-paid': facture.status === 'Payée',
                      'status-pending': facture.status === 'En attente',
                      'status-unpaid': facture.status === 'Impayée'
                    }">
                      {{ facture.status || '-' }}
                    </span>
                  </td>
                  <td>{{ facture.paymentDate ? (facture.paymentDate | date:'dd/MM/yyyy') : '-' }}</td>
                  <td>{{ facture.observations || '-' }}</td>
                </tr>
                <tr *ngIf="selectedBuildingFactures.length === 0">
                  <td colspan="8" class="no-data">Aucune facture pour ce bâtiment</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>